@{
    Layout = null;
    ViewData["Title"] = "Login";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - Volet</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <style>
        :root{
            --bg:#0b0f14;
            --panel:#0f1720;
            --panel2:#0d141c;
            --line:rgba(255,255,255,.10);
            --text:rgba(255,255,255,.92);
            --muted:rgba(255,255,255,.62);
            --muted2:rgba(255,255,255,.42);
            --accent:#28e0a3;
        }

        html,body{height:100%}
        body{
            margin:0;
            font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
            background: radial-gradient(1200px 600px at 50% -20%, rgba(40,224,163,.10), transparent 55%), var(--bg);
            color:var(--text);
        }
        a{color:var(--accent);text-decoration:none}
        a:hover{text-decoration:underline;color:var(--accent)}

        .auth-shell{min-height:100%;display:flex;flex-direction:column}
        .topbar{padding:28px 40px}
        .brand{font-weight:800;letter-spacing:.4px;font-size:28px;color:#fff}

        .auth-main{flex:1;display:flex;align-items:center;justify-content:center;padding:24px 18px 40px}
        .auth-grid{
            width:min(1120px,100%);
            display:grid;
            grid-template-columns:1fr;
            gap:34px;
            align-items:start;
        }
        @@media (min-width:992px){
            .auth-grid{grid-template-columns:1.05fr .95fr}
        }

        .headline{
            font-size:clamp(34px,3.2vw,50px);
            font-weight:800;
            margin:0 0 18px 0;
            letter-spacing:-.02em;
        }

        .panel{
            background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
            border:1px solid var(--line);
            border-radius:16px;
            padding:28px;
            box-shadow:0 20px 60px rgba(0,0,0,.35);
        }

        .form-label{
            color:var(--muted2);
            font-size:12px;
            letter-spacing:.08em;
            text-transform:uppercase;
            margin-bottom:8px;
        }
        .field{
            width:100%;
            background:transparent;
            border:1px solid var(--line);
            color:var(--text);
            padding:12px 14px;
            border-radius:10px;
            outline:none;
        }
        .field:focus{border-color:rgba(40,224,163,.6);box-shadow:0 0 0 3px rgba(40,224,163,.12)}

        .muted-link{color:var(--accent);font-weight:600;font-size:14px}

        .btn-auth{
            width:100%;
            border-radius:10px;
            padding:12px 14px;
            font-weight:700;
            letter-spacing:.02em;
            border:1px solid rgba(255,255,255,.12);
            background:rgba(255,255,255,.18);
            color:rgba(255,255,255,.72);
        }
        .btn-auth:hover{filter:brightness(1.05)}
        .btn-auth:disabled{opacity:.65;cursor:not-allowed}

        .below{
            margin-top:14px;
            color:var(--muted);
            text-align:center;
        }

        .info-card{
            background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
            border:1px solid var(--line);
            border-radius:16px;
            padding:22px;
        }
        .info-title{font-weight:800;margin:0 0 8px 0}
        .info-text{color:var(--muted);margin:0;line-height:1.55}

        .alertbox{
            display:none;
            border-radius:12px;
            padding:12px 14px;
            border:1px solid var(--line);
            margin-bottom:14px;
            font-weight:600;
        }
        .alert-success{display:block;background:rgba(40,224,163,.10);border-color:rgba(40,224,163,.25)}
        .alert-error{display:block;background:rgba(255,80,80,.10);border-color:rgba(255,80,80,.25)}

        .footer{
            border-top:1px solid var(--line);
            padding:18px 40px;
            color:var(--muted2);
            font-size:12px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:14px;
            flex-wrap:wrap;
        }
        .footer-links{display:flex;gap:18px;flex-wrap:wrap}
        .badge-row{display:flex;gap:18px;align-items:center;opacity:.7}
        .badge{
            border:1px solid var(--line);
            padding:6px 10px;
            border-radius:999px;
            font-weight:700;
            letter-spacing:.02em;
            color:rgba(255,255,255,.72);
        }
    </style>
</head>

<body>
    <div class="auth-shell">
        <div class="topbar">
            <div class="brand">volet</div>
        </div>

        <div class="auth-main">
            <div class="auth-grid">
                <!-- LEFT: FORM -->
                <div>
                    <h1 class="headline">Login</h1>

                    <div id="alertBox" class="alertbox"></div>

                    <div class="panel">
                        <form id="loginForm" autocomplete="off">
                            <div class="mb-3">
                                <div class="form-label">Email</div>
                                <input class="field" type="email" id="email" placeholder="" required />
                            </div>

                            <div class="mb-2">
                                <div class="form-label">Password</div>
                                <input class="field" type="password" id="password" placeholder="" required />
                            </div>

                            <div class="mb-3">
                                <a class="muted-link" href="#" onclick="return false;">Forgot password?</a>
                            </div>

                            <button class="btn-auth" id="loginBtn" type="submit">LOG IN</button>

                            <div class="below">
                                Don't have an account yet?
                                <a href="/register">Sign up for free!</a>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- RIGHT: INFO CARD -->
                <div class="info-card">
                    <h3 class="info-title">Create free crypto wallets instantly!</h3>
                    <p class="info-text">
                        Volet.com has crypto wallets! Store, send, receive BTC, ETH, USDT, USDC and other crypto,
                        quickly buy and sell coins, pay and get paid in crypto, send and receive free P2P crypto
                        transfers within Volet.com! Click + on the left and create a crypto wallet for free.
                    </p>
                </div>
            </div>
        </div>

        <div class="footer">
            <div>
                Queensland Foreign Exchange Inc. — Toronto, Ontario, Canada<br />
                Second February Limitada — Republic of Costa Rica<br />
                © 2025 Volet.com
            </div>

            <div class="footer-links">
                <a href="#" onclick="return false;">Cookies Policy</a>
                <a href="#" onclick="return false;">AML Program</a>
                <a href="#" onclick="return false;">Privacy Policy</a>
                <a href="#" onclick="return false;">Terms and Conditions</a>
            </div>

            <div class="badge-row">
                <span class="badge">PCI DSS</span>
                <span class="badge">Mastercard</span>
                <span class="badge">VISA</span>
            </div>
        </div>
    </div>

    <script>
        const alertBox = document.getElementById('alertBox');

        function showAlert(type, msg) {
            alertBox.className = 'alertbox ' + (type === 'success' ? 'alert-success' : 'alert-error');
            alertBox.textContent = msg;
        }

        // Handle /login?emailConfirmed=true
        (function () {
            const qp = new URLSearchParams(window.location.search);
            if (qp.get('emailConfirmed') === 'true') {
                if (qp.get('message') === 'already') {
                    showAlert('success', 'Email already confirmed. You can log in now.');
                } else {
                    showAlert('success', 'Email confirmed successfully. You can log in now.');
                }
            }
        })();

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const btn = document.getElementById('loginBtn');
            btn.disabled = true;

            try {
                const payload = {
                    email: document.getElementById('email').value.trim(),
                    password: document.getElementById('password').value
                };

                const res = await fetch('/api/Auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await res.json().catch(() => ({}));

                if (!res.ok) {
                    showAlert('error', data?.message || data?.Message || 'Invalid email or password.');
                    return;
                }

                // Store JWT (optional)
                if (data.token) {
                    localStorage.setItem('volet_token', data.token);
                }

                // Redirect wherever you want after login
                window.location.href = '/';
            } catch (err) {
                showAlert('error', 'Login failed. Please try again.');
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>